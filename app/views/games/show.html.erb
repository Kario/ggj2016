<script>
	var main_obj = <%= raw @riddles.to_json %>;
	
	createjs.Sound.registerSounds(
	[
	<% @riddles["scenarios"].each do |scenario| %>
		<% scenario["audio"].each do |audio| %>
			<% unless audio[1]["filename"].blank? %>
				{ id: "<%= audio[0].to_s %>", src: "<%= audio[1]["filename"].to_s %>" },
			<% end %>
		<% end %>
	<% end %>
	
	]
	,"/audio/");
	
	var queue = new createjs.LoadQueue();
	createjs.Sound.alternateExtensions = ["mp3"];
	queue.installPlugin(createjs.Sound);
	queue.addEventListener("fileload", handleFileLoad);
	queue.addEventListener("complete", handleComplete);
	
	
	queue.loadManifest([
		<% @riddles["scenarios"].each do |scenario| %>
			<% scenario["audio"].each do |audio| %>
				<% unless audio[1]["filename"].blank? %>
					{ id: "<%= scenario["bot"].to_s + "_" + audio[0].to_s %>", src: "/audio/<%= audio[1]["filename"].to_s %>" },
				<% end %>
			<% end %>
		<% end %>
	]);
	
	function handleFileLoad(event) {
		// A sound has been preloaded. This will fire TWICE
		console.log("Preloaded:", event.id, event.src);
	}
	function handleComplete(event) {
		// A sound has been preloaded. This will fire TWICE
		console.log("Preloading Complete");
		enableStart();
	}
	
	function enableStart() {
		$("#startBtn").fadeIn();
		$("#loadBar").fadeOut();
		
	}
	
</script>


<% @riddles["scenarios"].each do |scenario| %>
	<% scenario["audio"].each do |audio| %>
		<%= link_to(audio[1]["filename"], "#", :onclick => 'createjs.Sound.play("' + scenario["bot"].to_s + "_" + audio[0].to_s + '")') %>
	<% end %>
<% end %>

<div id="container">
	<div id="loadBar">Loading this shit</div>
	<div id="startBtn">Fuckin start this shit</div>
</div>